<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r122/three.js">
</script>
<script type="x-shader/x-vertex" id="vertexShader">

    varying vec2 vUv;
    varying vec3 vNormal;
    varying vec3 vPos;
    void main() {
        vUv = uv;
        vPos = (modelViewMatrix * vec4(position , 1.0)).xyz;
        vNormal = normalize(normalMatrix * normal);
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position , 1.0); 
    }
</script>
<script type="x-shader/x-fragment" id="fragmentShader">
  struct PointLight {
    vec3 position;
    vec3 color; 
 
 };
 varying vec3 vNormal;
 varying vec3 vPos;
 varying vec2 vUv;
 
 uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
 uniform sampler2D tex;
 
 void main() {
 
   
   vec3 color;
   for(int i=0;i<NUM_POINT_LIGHTS;i++){
       float block = 2.0;
       vec3 Pos = vec3(
         float(int(vPos[0]*block))/block,
         float(int(vPos[1]*block))/block,
         float(int(vPos[2]*block))/block
       );
 
       float lightness = max(1.0 - distance(pointLights[i].position , Pos) / 100.0,0.0);
      
       vec3 lightdir = normalize(pointLights[i].position - Pos);
       float diffuse = dot(vNormal, lightdir);
       
       //diffuse = float(int(diffuse * 20.0)) / 20.0;
       
       vec3 uvcolor = texture2D(tex,vUv).xyz;
       
       if(diffuse>0.8)
        diffuse=1.0;
        else if(diffuse>0.6)
        diffuse=0.7;
        else if(diffuse>0.4)
        diffuse=0.5;
        else if(diffuse>0.2)
        diffuse=0.3;
        else
        diffuse=0.1;
         
 
       gl_FragColor = vec4(diffuse*vec3(1.0,0.0,1.0),1.0);
   }
  
 
 }
</script>


<script type = "module">
  
  import {OrbitControls} from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/OrbitControls.js';



var scene = new THREE.Scene();

var light = new THREE.PointLight(0xff00ff,3);
light.position.set(0, 10, 10);
scene.add(light);
var textureLoader = new THREE.TextureLoader();
textureLoader.crossOrigin = '';
var material = new THREE.ShaderMaterial({
  uniforms: {
      ...THREE.UniformsLib.lights,
      tex:{type:"t",value:textureLoader.load("https://s.gravatar.com/avatar/445558b0f2709826cbc4bd7a2371ad55?size=50&default=retro")}
      
  },
  vertexShader: document.getElementById('vertexShader').innerHTML,
  fragmentShader: document.getElementById('fragmentShader').innerHTML,
  lights: true
});

var geometry = new THREE.TorusKnotGeometry(1, 0.3);
var knot = new THREE.Mesh(geometry, material);
scene.add(knot);

var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.z = 10;


var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

function render() {
  requestAnimationFrame(render);
  renderer.render(scene, camera);
}

new OrbitControls(camera,renderer.domElement);


render();


</script>


</body>